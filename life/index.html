<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
	<title>Game Life</title>
</head>
<body onload="main()">
<div><a href="http://yandex.ru/clck/jsredir?from=yandex.ru%3Bsearch%2F%3Bweb%3B%3B&text=&etext=1306.F_B5KcCM7OOn9CoXCDymYOOjN3HFEf4xZqt2ezMpve6fS_xVZ0YyBv6F6LO1z_LxE9EeuCTJ-vsgAiSDsKsJGA.79c3b65383f50a653e8b9c8cdc9e2be23308cf75&uuid=&state=PEtFfuTeVD5kpHnK9lio9T6U0-imFY5Ibl_FxS8ahbetb9q-Ws8tqQaT6YcO5ES2WU_XNsggvSsFTfHqJ8Yy-1diqrUkiHwNVkMEv806VSQ&data=UlNrNmk5WktYejY4cHFySjRXSWhXQzdLY3hSTVNzV2ZCVXgzZzFIWmJXemRtSl9GU3pqWkpZZHVXUjktbGpiMER5V3Z1eVRPT2hIUkk3UVZJYjVoN0NYM2VhVFM2T0h1aTJjY2ZxcnpFVUFsbFJ3elY2OHlVVkF5UmFRZTZmX2thbkN5QUI0UXBSa1hTdDVJZ1IzYXc0RFZIaEF4U1JXVlFTd2lQWDl3VVBUeXZ2bXV6bXJjek9OZUFrRTR5dThXZTRKdHNFRG9tQVJobzRCQUxEcThtaHZRZnZQWU1pN09NYnZhMVk2NkRzdnJOX1NsTlJWMS13&b64e=2&sign=5bae585a32ebf16342295808d5802955&keyno=0&cst=AiuY0DBWFJ4RhQyBNHa0i5ddmexjVv5T_0uyoLCJTEgK3iHdDM-CGZB-3bcZVAENwMzcIKT5EmZvaD9oFKu0Iqkmvq8_d8Nic8JLhlI3lVGGF4-cgrPLikCujdVIwxEHYPgYg5gDEuzgkejSdjhyQs9fq8VmcsBb_t3Sk5Oo9Bk6gKYFuAJIBzBrkVdHAhW2ZAIevTM1txPlYiiC-eXPpP8a-n5eijpka9xpAr8Dim71t7HVnwFbp0YxDhiRhN5gTrqLiQzEZjn-g62uMLt-uTm8FnUOTHOZf279OpUpeEv179qps0JIOCuirYmwGO6Y_hKI5tsh5J_M03KnsYtMST_qSop2yzuDiiLdlfLgK_7_w5mjhieSPmz11l7x9Y_1C5KWDAvK-FT7KizMNUVK-0gUEu8cnG0mtsYmojmETr_JxeQf9VmpxJJqpuvUm_HpUNULVNhTJ_QADT6UgB-ySvh1JSvluyrj73zo-HIocBdTe1darQwTGyAtFe_NLM5u-XlbCQb06Fjxc0wi_bo3CPpMLsKQElvE_2CEdmisCwW1l-SmzTaNdMgxc512KUVmLDWdlB5GwmeWlXUWdxCXREtYoFKCxVLXRWsTloNqPutT-dznsN_B8liS1vFISKjDF5RLE1M4GSCCBuqvTHT2Zuswd1DpkwjAfJzmuco7td4NrvCjqkdZU8nonpO5py5AiPpxNr10G7fliuIA0QtEDeQ9sxtA-r4c5_anxH1isJdFuHWpEAkQrLL9Nrm6qFUq2H8BuHdXLtRPMfGh2rTSKgvjeu8Qk5Gnozl8EW0hVoQqacKmWocFj8b25fYrccYcYgZ-KRydyQ4y8VBUyYOgg9W4-HePrDhubAgPS8lbitL4-XGyATPViFsdydRwUnwg&ref=orjY4mGPRjk5boDnW0uvlrrd71vZw9kpVTCc3aRxQ_iAM_39bXBuCm5ihLwRHtJihZ8TVRy5nrJpvW-YUDenyeKTJDKphgyu0B0CTJPdJku-XXpvKemwByQYdckjprAGA3fJa0sCRxeqcuRz6QrF-2wy-cTSRfI_REyW542Lx3FFFXzjLUPhctgIoVYyup5Cv8RqlRJ8oXxcg8mWLoWc_qPWVm-wPFHj7u95yBjXYXA&l10n=ru&cts=1484826931243&mc=4.6506615136785685">Игра Жизнь</a></div>
<div>
	<canvas id="canvas" style="float:left; border: dotted 1px gray;"> </canvas>
</div>
<div style="float:left;">
	<div style="//border: dotted 1px gray;">
		Размеры поля:
		<br>
		<input id ="y_field" type="number" style="width:40px" value="20">
		<input id ="x_field" type="number" style="width:40px" value="20">
		<input type="button" value="Создать поле" onclick="main()">
		<br>
		Размер клеточек:
		<br>
		<input id ="size" type="number" style="width:40px" value="14" onchange="changeSize()">
	</div>
	<br><br>
	<input type="button" onclick="restart();"value="Рестарт"><br>
	<input type="button" onclick="visArr();"value="Массив"><br>
	<input type="button" onclick="step1();"value="Шаг"><br>
	<input type="button" onclick="run();"value="Запустить"><br>
	<input type="button" onclick="clearInterval(timerId);"value="Пауза">
	<input type="button" onclick="virus();"value="Вирус"><br>
	<div id="coords"></div>
</div>
	<div id="coords1" style="float:left"></div>
	<script>
	var canvas = document.getElementById("canvas");//холст
	var ctx = canvas.getContext("2d");//рабочее пространство
	var coords = document.getElementById('coords');//текстовое поле для отладки
	var coords1 = document.getElementById('coords1');//текстовое поле для массива
	var x_field=20;//высота
	var y_field=20;//ширина
	var field=[];//обнуление массива
	for (var i=0;i<x_field;i++){
		field[i]=[];
		for (var j=0;j<y_field;j++){
			field[i][j]=0;
		}
	}	
	var isdown=0;//проверка нажатия клавиши
	var speed =1000/24;//скорость игры
	var size =14;//размер клеток
	var timerId;//хз что за переменная, но она включает таймер
	
	/*отрисовка*/
	function draw(){
		ctx.fillStyle="#000";//заливка
		ctx.fillRect(0,0,canvas.width,canvas.height)
		if(size>4){//если клеточки больше 4пикселов то линии рисуются
			ctx.lineWidth = "1";
			ctx.strokeStyle = "#ccc"
			ctx.beginPath()
			for(var i=0;i<=x_field;i++){
				ctx.moveTo(20+0.5,20+i*size+0.5);
				ctx.lineTo(20+0.5+y_field*size,20+i*size+0.5);
			}
			for(var i=0;i<=y_field;i++){
				ctx.moveTo(20+i*size+0.5,20+0.5);
				ctx.lineTo(20+i*size+0.5,20+x_field*size+0.5);
			}
			ctx.stroke();
		}

		for (var i=0;i<y_field;i++){//отображение массива
			for (var j=0;j<x_field;j++){
				if(field[j][i]==3){//транспонирование для отображения массива
					ctx.fillStyle="#0c0";
					if(size>4){	ctx.fillRect(i*size+21,j*size+21,size-1,size-1);}
					else {ctx.fillRect(i*size+21,j*size+21,size,size);}
				}
			}
		}
	}
	/*выполнение шагов по таймеру*/
	function run(){
		timerId = setInterval(function() {step1();}, speed);
	}
	
	/*переход на следующую итерацию*/
	function step1(){
		for (var i=0;i<x_field;i++){//сохранение текущих живых клеток
			for (var j=0;j<y_field;j++){
				if(field[i][j]==3){
					field[i][j]=10;}}}
					
		for (var i=0;i<x_field;i++){//для каждой живой клетки добавляем по 1 ко всем окружающим клекткам
			for (var j=0;j<y_field;j++){
				if(field[i][j]>=10){
					if((i>0)&&(j>0)){field[i-1][j-1]++;}
					if(i>0){field[i-1][j]++;}
					if((i>0)&&(j<y_field-1)){field[i-1][j+1]++;}
					if((i<x_field-1)&&(j>0)){field[i+1][j-1]++;}
					if(i<x_field-1){field[i+1][j]++;}
					if((i<x_field-1)&&(j<y_field-1)){field[i+1][j+1]++;}
					if(j>0){field[i][j-1]++;}
					if(j<y_field-1){field[i][j+1]++;}
				}
			}
		}
		for (var i=0;i<x_field;i++){//оживление мертвых клеток у которых 3 соседа, оставление живыми живых у которых 2 или 3 соседа
			for (var j=0;j<y_field;j++){
				field[i][j]=((field[i][j]==3)||(field[i][j]==12)||(field[i][j]==13))?3:0;
			}
		}
		//visArr();
		draw();
	}
	
	/*отображает массив*/
	function visArr(){
	coords1.innerHTML="";
	for (var i=0;i<x_field;i++){
		coords1.innerHTML=coords1.innerHTML+field[i]+"<br>";
		}
	}
	
	/*обработка нажатия клавиши мыши*/
	canvas.onmousedown=function(){
		if(field[y][x]==0){//если при нажатии мертвая клетка - начинаем оживлять
			isdown=1;
			field[y][x]=3;
		}
		else if(field[y][x]==3){//если при нажатии живая клетка - начинаем умертщвлять
			isdown=2;
			field[y][x]=0;
		}
	}
	/*обработка отпуска клавиши мыши*/
	canvas.onmouseup=function(){
		isdown=0;
		if(isdown==1)field[y][x]=3
		else if(isdown==2)field[y][x]=0;
		draw();
	}
	
	/*перерисовка когда мышка уходит с холста*/
	canvas.onmouseleave=function(){
	draw();}
	
	/*обработка движения мыши*/
	canvas.onmousemove=function (e) {
		box = canvas.getBoundingClientRect();//какие то уведенные с инета формулы которые дают кооржинаты клеточки массива на которой стоит курсор
		x = Math.floor((e.pageX-box.left-20-pageXOffset)/size);
		y = Math.floor((e.pageY-box.top-20-pageYOffset)/size);
		if(((x>=0)&&(x<y_field))&&((y>=0)&&(y<x_field))){
			if(isdown==1){field[y][x]=3;}
			else if(isdown==2){field[y][x]=0;}
			draw();
			ctx.fillStyle="rgba(255,255,255,.4)";//"подсветка клеточки"
			if(size>4){	ctx.fillRect(x*size+21,y*size+21,size-1,size-1);}
					else {ctx.fillRect(x*size+21,y*size+21,size,size);}
			//visArr();
		}
	};
	
	/*рестарт*/
	function restart(){//обнуление массива и перерисовка
	for (var i=0;i<x_field;i++){
		field[i]=[];
		for (var j=0;j<y_field;j++){
			field[i][j]=0;
		}
	}	
	clearInterval(timerId);//выключение таймера
	draw();
	}
	
	/*изменение размера клеточек*/
	function changeSize(){
		if(document.getElementById("size").value>0){
			size=document.getElementById("size").value;
		}
		canvas.width=size*y_field+40;//размеры холста
		canvas.height=size*x_field+40;
		draw();
	}
	
	/*функция создания*/
	function main(){
		if(document.getElementById("y_field").value>0){
			y_field=document.getElementById("y_field").value;
			
		}
		if(document.getElementById("x_field").value>0){
			if(document.getElementById("x_field").value<=x_field){
				x_field=document.getElementById("x_field").value;
				
			}
			else{//какая то магия которая добавляет масив(строку) в конец массива(поля)
				while(document.getElementById("x_field").value>x_field){
					field.push([]);
					x_field++;
				}
			}
		}
		changeSize();
		restart();
		
	}
	
	/**/
	function virus(){
		for (var i=1;i<x_field-2;i=i+3){
			for (var j=1;j<y_field-2;j=j+3){
				field[i][j]=3;
				field[i][j+1]=3;
				field[i+1][j]=3;
				field[i+1][j+1]=3;			
			}
		}
		draw();
	}
	
	</script>
</body>
</html>